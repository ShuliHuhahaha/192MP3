---
title: "MP3"
author: "Shuli Hu, Karina Huang, Iris Dong"
output: html_document
---

```{r}
library(mdsr)
library(RMySQL)
db <- dbConnect_scidb(dbname = "imdb")
db %>%
  dbGetQuery("SELECT * FROM kind_type;")
```

```{r}
dbListTables(db)
```

```{r}
western.movie <- db %>%
  dbGetQuery("SELECT m.movie_id, t.title, t.production_year
              FROM movie_info m
              JOIN title t ON t.id = m.movie_id
              WHERE m.info_type_id = 3
              AND m.info = 'Western'
              AND t.kind_id = 1
              AND t.production_year >= 1900
              AND t.production_year <= 2015
              ORDER BY production_year, title;"
             )
```

```{r}
save(western.movie, file = "western.movie.rda")
```

```{r}
load(file = "western.movie.rda")
```

```{r}
movie.genre <- db %>%
  dbGetQuery("SELECT m.movie_id, t.title, t.production_year, m.info
              FROM movie_info m
              JOIN title t ON t.id = m.movie_id
              WHERE m.info_type_id = 3
              AND t.kind_id = 1
              AND t.production_year >= 1900
              AND t.production_year <= 2015
              ORDER BY production_year, title;"
             )
```

```{r}
save(movie.genre, file = "movie.genre.rda")
```

```{r}
load(file = "movie.genre.rda")
```

```{r}
library(dplyr)

movie.graph <- left_join(western.movie, movie.genre, by = "movie_id") 
```

```{r}
movie.graph2 <- movie.graph %>%
  filter(production_year.x == 1912 & info != "Western") %>%
  select(-production_year.y) 
```

```{r}
movie.graph3 <- movie.graph %>%
  filter(production_year.x == 2014 & info != "Western") %>%
  select(-production_year.y)
```

```{r}
library(ggplot2)

ggplot(movie.graph2, aes(x=info)) + geom_bar()
```
```{r}
ggplot(movie.graph3, aes(x=info)) + geom_bar()
```

